<HTML>
  <head>
<style>
table, th, td {
  border: 1px solid black;
}
</style>
</head>
  <BODY>  <P><H1>MongoDB Evaluation Cluster</H1></P>

  <P><H2>Purpose</H2></P>
  <OL>
    <LI>Become proficient at:
        <UL>
          <LI>instantiating a sharded, highly-available MongoDB cluster,</LI>
          <LI>loading and querying MongoDB, </LI>
          <LI>data design involved in database/collection creation and document specification,</LI>
          <LI>operating MongoDB services, </LI>
          <LI>operating MongoDB as a cluster, and </LI>
          <LI>automating all operations associated with an implementation of a MongoDB cluster.</LI>
        </UL>
    <LI>Understanding MongoDB's value proposition.</LI>
    <LI>Contrast MongoDB with known SQL and MPP solutions.</LI>
    <LI>Be prepared to compare/contrast MongoDB with other future datastores to be evaluated (e.g., Cassandra, Redis, BigTable).</LI>
    <LI>Using Terraform for IaC operations.</LI>
    <LI>Using Ansible for server configuration.</LI>
    <LI>Using Python and libraries to simulate application write and read activity on MongoDB.</LI>
    <LI>Build and optimize multi-stage Aggregation Pipelines (Complex Aggregation Pipelines) that perform complex data transformations, grouping, sorting, and calculations within the database.</LI>
    <LI>Design and manage a complete indexing strategy that minimizes disk I/O.(Indexing Strategy)</LI>
    <LI>Use built-in tools (explain, nReturned to nExamined ratio) to diagnose slow operations.(Performance Tuning and Analysis)</LI>
    <LI>Use Multi-Document ACID Transactions correctly to ensure data consistency when updating related documents across multiple collections.</LI>
    <LI>Schema Validation: Enforce data structure and integrity while retaining the document model's flexibility.</LI>
    <LI>Understand and manage replica sets, including manual failover, recovery, and setting read and write concerns to balance durability and performance.</LI>
    <LI>Configure Role-Based Access Control (RBAC) by creating custom roles with the minimum necessary privileges (read, readWrite, dbAdmin) for different application components and user groups.</LI>
  </OL>

  <P>
  <a href="https://lucid.app/lucidspark/73ed9ec8-27ee-4b67-b026-0d058017b2e7/edit?viewport_loc=-4248%2C-5047%2C1835%2C1036%2C0_0&invitationId=inv_2f013479-0d35-46e2-8b5c-8bd6231f0f00">
    Diagram for Evaluation Cluster</a> | </P>

  <P><H2>VM Specifications for Cluster Roles and Evaluation/Testing</H2></P>
    <P>Applicable to all VM roles:</P>
    <UL>
      <LI> Use preemtible VMs. </LI>
      <LI> Use a tag for the project (MongoDB) for all VMs defined.</LI>
      <LI> Use a tag for the role for all VMs defined. Allow them to be monitored by this role in GCP dashboards.</LI>
      <LI> Ensure all disks are deleted when the VM is deleted. (May not be the default.)</LI>
      <LI> Use a Debian OS image.</LI>
      <LI> Only use Terraform (gcloud behind the scenes) and ansible. Do not run commands maually. Do not login to the VMs except to troubleshoot issues.</LI>
    </UL>
  <TABLE>
    <TR>
      <TH>Category</TH>
      <TH>Naming Convention</TH>
      <TH>VM Count</TH>
      <TH>vCPU</TH>
      <TH>Memory</TH>
      <TH>Disk Size<BR>(Type)</TH>
      <TH>Needed Software</TH>
      <TH>systemctl Entries</TH></TH>
    </TR>
  <TR>
      <TD>Config Server Replica Set</TD>
      <TD>mongo-config-server-n</TD>
      <TD style="text-align:center">3</TD>
      <TD style="text-align:center">1</TD>
      <TD style="text-align:center">3 GB<BR>(1GB/vCPU)<BR>(2GB for OS)</TD>
      <TD style="text-align:center">20 GB<BR>(SSD)</TD>
     <TD>mongodb-org (meta package)<BR>gnupg and curl</TD>
     <TD>mongod (unique config file)</TD>
    </TR>
      <TR>
      <TD>Data Nodes</TD>
      <TD>mongo-data-node-n</TD>
      <TD style="text-align:center">2 (or 3) per shard<BR>Planning 2 shards<BR>4 or 6</TD>
      <TD style="text-align:center">2</TD>
      <TD style="text-align:center">10 GB<BR>(4GB/vCPU)<BR>(2GB for OS)</TD>
      <TD style="text-align:center">100 GB<BR> (SSD)</TD>
     <TD>mongodb-org (meta package)<BR>gnupg and curl</TD>
        <TD>mongod</TD>
    </TR>
  <TR>
      <TD>mongos</TD>
      <TD>mongos-router-n</TD>
      <TD style="text-align:center">2</TD>
      <TD style="text-align:center">1</TD>
      <TD style="text-align:center">3 GB<BR>(1GB/vCPU)<BR>(2GB for OS)</TD>
      <TD style="text-align:center">20 GB<BR>(HDD)</TD>
     <TD>mongodb-org (meta package)<BR>gnupg and curl</TD><
      <TD>mongos</TD>
    </TR>
     <TR>
      <TD>Data Producer(s)</TD>
      <TD>mongo-test-producer-node-n</TD>
      <TD style="text-align:center">1 to ...</TD>
      <TD style="text-align:center">1</TD>
      <TD style="text-align:center">2 GB</TD>
      <TD style="text-align:center">20 GB<BR>(HDD)</TD>
      <TD>pymongo<BR>Project Code Repository</TD>
       <TD>TBD</TD>
     </TR>
    <TR>
      <TD>Data Consumer(s)</TD>
      <TD>mongo-test-client-node-n</TD>
      <TD style="text-align:center">1 to ...</TD>
      <TD style="text-align:center">1</TD>
      <TD style="text-align:center">2 GB</TD>
      <TD style="text-align:center">20 GB<BR>(HDD)</TD>
      <TD>pymongo<BR>Project Code Repository</TD>
      <TD>TBD</TD>
    </TR>
    
  </TABLE>

    <P><H2>Collections</H2></P>
    <TABLE>
      <TR>
        <TH>Database</TH>
        <TH>Collection</TH>
        <TH>Purpose(s)</TH>
      </TR>
      <TR>
        <TD>retail</TD><TD>customer</TD><TD>Joined to order & order_line</TD>
        <TD>retail</TD><TD>order</TD><TD>Joined to order_line.  Contains data for the order as a whole (e.g., customer ID , shipping_address) </TD>
        <TD>retail</TD><TD>order_line</TD><TD>Lowest level of the retail transaction log.</TD>
        <TD>retail</TD><TD>order_line_denormalized</TD><TD>Lowest level of the retail transaction log. Added </TD>
        <TD>banking</TD><TD>TBD</TD><TD>As needed for multi-document ACID experiments. </TD>
        <TD>hr</TD><TD>employee</TD><TD>Joined to timecard_punch.RBAC experimentation.</TD>
        <TD>hr</TD><TD>timecard_punch.</TD><TD>Voluminous data for write throughput testing.</TD>
      </TR>
    </TABLE>

    <P><H2>To Consider</H2></P>
    <UL>
      <LI>Monitor Memory Usage across the MongoDB cluster's VMs - Monitoring memory usage across a group of servers in GCP requires two main steps: installing the Ops Agent on your VMs to collect the OS-level memory metrics and then creating a custom dashboard in Cloud Monitoring to visualize the aggregated data.
      </LI>
      <LI>Can all processes be started automatically when each VM boots?</LI>
      <LI>Investigate whether order_line needs to be completely denormalized or we can join order_line, order , and customer.</LI>
      <LI>Verify documents can be updated. For example, a customer's name, shipping address(es)</LI>
    </UL>
    </BODY>
</HTML>
